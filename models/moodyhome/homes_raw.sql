{{ config(materialized='table') }}

SELECT 
    t.$1:address::string as address,
    t.$1:addressCity::string as address_city,
    t.$1:addressState::string as address_state,
    t.$1:addressStreet::string as address_street,
    t.$1:addressZipcode::string as address_zipcode,
    t.$1:area::number as area,
    t.$1:baths::number as baths,
    t.$1:beds::number as beds,
    t.$1:brokerName::string as broker_name,
    t.$1:carouselPhotos::variant as photos,
    t.$1:countryCurrency::string as country_currency,
    t.$1:detailUrl::string as url,
    t.$1:flexFieldText::string as flex_field_text,
    t.$1:flexFieldType::string as flex_field_type,
    t.$1:has3DModel::boolean as has_3d_model,
    t.$1:hasAdditionalAttributions::boolean as has_additional_attributions,
    t.$1:hasImage::boolean as has_image,
    t.$1:hasVideo::boolean as has_video,
    t.$1:hdpData:homeInfo:bathrooms::number as bathroom,
    t.$1:hdpData:homeInfo:bedrooms::number as bedrooms,
    t.$1:hdpData:homeInfo:city::string as city,
    t.$1:hdpData:homeInfo:country::string as country,
    t.$1:hdpData:homeInfo:currency::string as currency,
    t.$1:hdpData:homeInfo:daysOnZillow::number as days_on_zillow,
    t.$1:hdpData:homeInfo:homeStatus::string as home_status,
    t.$1:hdpData:homeInfo:homeStatusForHDP::string as home_status_for_hdp,
    t.$1:hdpData:homeInfo:homeType::string as home_type,
    t.$1:hdpData:homeInfo:isFeatured::boolean as is_featured,
    t.$1:hdpData:homeInfo:isNonOwnerOccupied::boolean as is_non_owner_occupied,
    t.$1:hdpData:homeInfo:isPreforeclosureAuction::number as is_preforceclosure_auction,
    t.$1:hdpData:homeInfo:isPremierBuilder::boolean as is_premier_building,
    t.$1:hdpData:homeInfo:isShowcaseListing::boolean as is_showcase_listing_hdpdata,
    t.$1:hdpData:homeInfo:isUnmappable::boolean as is_unmappable,
    t.$1:hdpData:homeInfo:isZillowOwned::boolean as is_zillow_owns_hdpdata,
    t.$1:hdpData:homeInfo:latitude::float as latitude,
    t.$1:hdpData:homeInfo:listing_sub_type::variant as listing_sub_type,
    t.$1:hdpData:homeInfo:livingArea::number as living_area,
    t.$1:hdpData:homeInfo:longitude::float as longitude,
    t.$1:hdpData:homeInfo:lotAreaUnit::string as lot_area_unit,
    t.$1:hdpData:homeInfo:lotAreaValue::float as lot_area_value,
    t.$1:hdpData:homeInfo:price as price_hdpdata,
    t.$1:hdpData:homeInfo:priceForHDP::number as price_for_hdp,
    t.$1:hdpData:homeInfo:shouldHighlight::boolean as should_highlight,
    t.$1:hdpData:homeInfo:state::string as state,
    t.$1:hdpData:homeInfo:streetAddress::string as street_address,
    t.$1:hdpData:homeInfo:taxAssessedValue::number as tax_assessed_value,
    t.$1:hdpData:homeInfo:timeOnZillow::number as time_on_zillow,
    t.$1:hdpData:homeInfo:zipcode::string as zipcode,
    t.$1:hdpData:homeInfo:zpid::number as zpid_hdpdata,
    t.$1:imgSrc::string as img_src,
    t.$1:info3String::string as info3string,
    t.$1:ingestion_timestamp::string as ingestion_timestamp,
    t.$1:isFeaturedListing::boolean as is_featured_listing,
    t.$1:isHomeRec::boolean as is_home_rec,
    t.$1:isSaved::boolean as is_saved,
    t.$1:isShowcaseListing::boolean as is_showcase_listing,
    t.$1:isUndisclosedAddress::boolean as is_undisclosed_address,
    t.$1:isUserClaimingOwner::boolean as is_user_claiming_owner,
    t.$1:isUserConfirmedClaim::boolean as is_user_confirmed_claim,
    t.$1:isZillowOwned::boolean as is_zillow_owned,
    t.$1:latLong::variant as lat_long,
    t.$1:"list"::boolean as "LIST",
    t.$1:marketingStatusSimplifiedCd::string as marketing_status_simplified_cd,
    t.$1:id::number as id,
    t.$1:pgapt::string as pgapt,
    -- REPLACE(REPLACE(REPLACE(t.$1:price::string, '$', ''), ',', ''), '+', '')::number as price,
    t.$1:price::string as price,
    t.$1:rawHomeStatusCd::string as raw_home_status_cd,
    t.$1:relaxed::boolean as relaxed,
    t.$1:sgapt::string as sgapt,
    t.$1:shouldShowZestimateAsPrice::boolean as should_show_zestimate_as_price,
    t.$1:source::string as source,
    t.$1:statusText::string as status_text,
    t.$1:statusType::string as status_type,
    t.$1:unformattedPrice::number as unformatted_price,
    t.$1:zpid::number as zpid,
    
from  @moodyhome.raw.moodyhome_s3_stage (file_format => 'MOODYHOME.RAW.JSON_FORMAT') as t
where contains(t.$1:id::variant, '--') = 0
and t.$1:source = 'zillow'